# 9. 스프링 프로젝트 시작하기
## 자바 엔터프라이즈 플랫폼과 스프링 애플리케이션
스프링은 어떤 플랫폼에서도 사용될 수 있지만, 기본적으로는 자바 엔터프라이즈 플랫폼(JavaEE)에 최적화되어 있다. 
HTTP를 통해 접근하는 웹 클라이언트와 백엔드 DB를 사용하는 애플리케이션에 적합하다.

스프링으로 만은 애플리케이션을 배포하려면 JavaEE 서버가 필요하다. JavaEE 표준을 따르는 애플리케이션 서버는 크게 두 가지로 구분할 수 있다.
- 경량급 WAS/서블릿 컨테이너 : Tomcat이나 Jetty 같은 가벼운 서블릿 컨테이너만 있어도 사용 가능하다. 엔터프라이즈 애플리케이션에 필요한 핵심 기능을 모두 이용할 수 있다.
- WAS : 고도의 안정성이나 고성능 시스템에서 필요한 리소스 관리, 레거시 시스템의 연동 등의 필요가 있다면 상용 또는 오픈소스 WAS를 사용할 수 있다. 상대적으로 관리 기능이나 모니터링 기능이 뛰어나 여러 대의 서버를 동시에 운영할 때 유리하다.

### 스프링 애플리케이션의 배포 단위
스프링으로 만든 애플리케이션은 다음의 세 가지 단위로 배포할 수 있다.
- 독립 웹 모듈 : 스프링은 보통 war로 패키징된 독립 웹 모듈로 배포된다.
- 엔터프라이즈 애플리케이션 : 확장자가 ear인 엔터프라이즈 애플리케이션으로 패키징해서 배포할 수 있다. 하나 이상의 웹 모듈과 별도로 분리된 공유 가능한 스프링 컨텍스트를 엔터프라이즈 애플리케이션으로 묶어주는 방법이다.
- 백그라운드 서비스 모듈 : 확장자가 rar인 패키징 방법이다. 리소스 커넥터를 만들어 배포할 때 사용하는 방식인데, 스프링 애플리케이션이 UI가 필요 없고 서버 내에서 백그라운드 서비스처럼 동작할 필요가 있다면 rar 모듈로 만들어 배포할 수 있다.

## 개발도구와 환경
스프링을 사용하려면 스프링 버전과 호환되는 JDK 버전을 사용해야 한다.

스프링 개발과정에 필요한 일을 처리하도록 도와주는 통합개발환경(IDE)를 사용하는 것이 편하다.
대표적으로 이클립스, 넷빈즈, IntelliJ IDEA 등이 있다.

만약 스프링 애플리케이션 개발을 위한 IDE로 이클립스를 선택했다면, 스프링 개발 업체인 스프링소스에서 만든 이클립스 확장판인 SpringSource Tool Suite(STS)를 사용하는 것도 좋다. 스프링 지원 플러그인과 관련 도구를 제공한다.

### 라이브러리 관리와 빌드 툴
스프링 애플리케이션을 만들 때 필요한 라이브러리의 종류와 버전을 관리하는 것은 쉽지 않다.

Maven 같은 빌드 툴에서는 의존 라이브러리 관리 기능을 지원한다. 
애플리케이션이 필요로 하는 라이브러리를 선언해두면 원격 서버에서 자동으로 다운로드해서 사용할 수 있게 해준다.
또한 라이브러리가 동작하는데 필요한 다른 라이브러리까지 함께 다운로드해준다.


## 애플리케이션 아키텍처
아키텍처는 내부 구성요소들이 어떤 책임을 갖고 있고, 어떤 방식으로 서로 관계를 맺고 동작하는지를 규정하는 것이라고 할 수 있다.

### 계층형 아키텍처
책임과 성격이 다른 것을 크게 그룹으로 만들어 분리해두는 것을 계층형 아키텍처 또는 멀티 티어 아키텍처라고 한다.

웹 기반의 엔터프라이즈 애플리케이션은 일반적으로 3계층 애플리케이션이라고도 한다.
3계층 아키텍처는 DB나 레거시 시스템과 연동하는 데이터 액세스 계층, 비즈니스 로직을 담고 있는 서비스 계층, UI를 만들어내고 그 흐름을 관리하는 프레젠테이션 계층으로 구분한다.

각 계층은 자신의 역할에만 충실해야 하고 자신과 관련된 기술이 아닌 다른 기술 API의 사용을 삼가해야 한다.
계층 간에 사용되는 인터페이스에는 특정 계층의 기술이 최대한 드러나지 않아야 한다. 리턴 타입이나 예외 등 특정 계층의 기술을 노출하게 되면 계층 간에 강한 결합이 생기면서 유연성이 떨어지기 때문이다. 계층의 경계를 넘어갈 때는 반드시 특정 계층에 종속되지 않는 오브젝트 형태로 변환해줘야 한다.

### 애플리케이션 정보 아키텍처
애플리케이션에 존재하는 정보를 데이터로 다루는 경우와 오브젝트로 다루는 경우로 구분해볼 수 있다.
데이터 중심 아키텍처는 DB에 무게를 두는 구조와 서비스 계층의 코드에 무게를 두는 구조로 구분할 수 있다.

#### DB/SQL 중심의 로직 구현 방식
데이터 중심 구조의 특징은 하나의 업무 트랜잭션에 모든 계층의 코드가 종속되는 경향이 있다는 점이다.
업무 내용이 바뀌면 모든 계층의 코드가 함께 변경된다.
주요 비즈니스 로직이 SQL과 DB에 존재한다.
이런 방식은 각 계층의 코드가 긴밀하게 연결되어 있어서 객체지향의 장점이 별로 활용되지 못할 뿐만 아니라 중복을 제거하기도 쉽지 않다. 애플리케이션 서버에 비해 상대적으로 DB는 확장 비용이 높기 때문에 로직을 DB보다는 애플리케이션으로 가져오는 것이 좋다. 그리고 SQL이나 저장 프로시저에 담긴 로직은 테스트하기 힘들다.

#### 거대한 서비스 계층 방식
DB에서는 상대적으로 단순한 작업을 하도록 하고, 대부분의 로직을 서비스 계층에서 하도록 하는 것이다.
상대적으로 객체지향의 장점을 살릴 기회가 많아지고 테스트가 수월해진다.
하지만 서비스 계층의 업무 트랜잭션에 따라 데이터 액세스 계층의 코드가 만들어지기 쉽다. 그래서 계층 간의 결함도는 여전히 크다.
화면을 중심으로 하는 업무 트랜잭션 단위로 코드가 모이기 때문에 로직을 일반화하기가 힘들고 중복이 많아진다.

### 오브젝트 중심 아키텍처
도메인 모델을 반영하는 오브젝트 구조를 만들고, 이를 각 계층 사이에서 정보를 전송하는데 사용하는 것이다.

데이터 방식에서는 엔티티를 조합한 정보를 화면에 출력하기 위해 SQL JOIN을 사용해 결과를 맵이나 배열에 담고, 그 맵이나 배열 결과를 서비스 계층에 전달한다. 따라서 SQL이 만드는 결과에 모든 계층의 코드가 의존하게 된다.

반면 오브젝트 방식에서는 정보가 도메인 모델을 반영해서 만들어진 오브젝트에 담기고, 도메인 오브젝트가 전 계층에서 일관된 구조를 유지한 채로 사용될 수 있다. SQL이나 웹 출력 포맷, 입력 폼 등에 종속되지 않는 일관된 형식의 정보를 다룰 수 있다.

오브젝트간의 관계는 레퍼런스 변수를 이용해서 다른 오브젝트를 참조하는 방식을 사용한다. 각 계층에서는 도메인 오브젝트에 담긴 정보를 활용해서 작업을 처리하게 된다.

다만 최적화된 SQL을 매번 만들어 사용하는 경우에 비해 성능면에서는 조금 손해를 볼 수도 있다.
그리고 오브젝트 관계에서도 필요없는 관계의 오브젝트까지 조회해서 가져오는 낭비가 발생하게 된다.

이런 문제를 해결하기 위해 지연된 로딩(lazy loading) 기법을 사용해 일단 최소한의 오브젝트 정보만 읽어오고 필요한 경우에만 다이내믹하게 DB에서 다시 읽어오게 할 수 있다.
가장 이상적인 방법은 오브젝트/RDB 매핑(ORM) 기술을 사용하는 것이다.

#### 빈약한 도메인 오브젝트 방식
도메인 오브젝트에 정보만 담고 있고, 정보를 활용하는 아무 기능도 갖고있지 않은 오브젝트를 빈약한(anemic) 오브젝트라고 부른다.
대부분의 비즈니스 로직은 서비스 계층에 존재한다. 
로직의 재사용성이 떨어지고 중복의 문제가 발생하기 쉽다는 단점이 있지만, 비즈니스 로직이 복잡하지 않다면 가장 만들기 쉽고 3계층 구조의 특징을 잘 살려서 개발할 수 있는 방식이다.

#### 풍성한 도메인 오브젝트 방식
도메인 오브젝트가 가진 정보와 깊은 관계가 있는 로직을 서비스 계층이 아니라 도메인 오브젝트에 넣어주고, 서비스 계층의 비즈니스 로직에서 재사용하게 만드는 것이다.
데이터와 그것을 사용하는 기능이 한곳에 모여있기 때문에 응집도가 높다.

여러 종류의 도메인 오브젝트의 기능을 조합하는 복잡한 비즈니스 로직은 서비스 계층 오브젝트에 두는 것이 적당하다.
도메인 오브젝트는 빈이 아니기 때문에 데이터 액세스 계층이나 다른 서비스 계층에 직접 접근하기 위해서 서비스 계층이 필요하기도 하다.

#### 도메인 계층 방식
도메인 계층 방식은 도메인 오브젝트가 기존 3계층과 같은 레벨로 격상되어 하나의 계층을 이뤄서 서비스 계층과 데이터 액세스 계층 사에에 존재하게 하는 것이다.
도메인에 종속적인 비즈니스 로직의 처리는 서비스 계층이 아니라 도메인 계층의 오브젝트 안에서 진행된다.
도메인 오브젝트가 데이터 액세스 계층이나 기반 계층의 기능을 직접 활용할 수도 있다.
스프링이 관리하지 않는 오브젝트에 DI를 적용하기 위해 AOP를 사용해야 한다.

여러 도메인 오브젝트의 기능을 조합해서 복잡한 작업을 진행하거나, 도메인 계층을 거치지 않고 바로 데이터 액세스 계층으로부터 정보를 가져오는 등의 작업을 위해서 서비스 계층은 필요하다. 대신 서비스 계층의 비중과 규모는 훨씬 작아진다.

도메인 오브젝트를 독립적인 계층으로 만들려고 할 때 고려해야할 중요한 사항이 있다. 도메인 오브젝트가 도메인 계층을 벗어나서도 사용되게 할지 말지 결정해야 한다.
모든 계층에서 도메인 오브젝트를 사용하게 한다면 철저한 개발 가이드라인을 적용해 오브젝트의 중요한 비즈니스 로직을 담은 메소드를 함부로 사용하지 못하게 해야한다.
다른 방법으로는, 도메인 오브젝트는 도메인 계층을 벗어나지 못하게 하는 것이다. 도메인 계층 밖으로 전달할 때는 DTO를 이용해 도메인 오브젝트의 내용을 복사해서 전달하게 하면 된다.

도메인 계층 방식을 선택하는 경우는 매우 복잡하고 변경이 잦은 도메인을 가졌을 때다. 복잡한 도메인 구조와 로직을 최대한 도메인 계층의 오브젝트에 반영하고, 도메인 모델과 설계에 변경이 발생했을 때 빠르게 대응하기 위해서다.
도메인 계층은 응집도가 매우 높기 때문에 테스트하기 쉽다. 하지만 그만큼 복잡하지 않은 애플리케이션이라면 이런 방식을 선택하는 것 자체가 부담을 줄 수 있다.